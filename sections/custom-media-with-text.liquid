{{ 'custom-media-with-text.css' | asset_url | stylesheet_tag }}

{% liquid
    # Blocks
    assign section_headings = section.blocks | where: 'type', 'text'
    assign section_media = section.blocks | where: 'type', 'media'
%}

<section class="b-custom-media-with-text padding-40">
    <div class="l">
        <div class="b-custom-media-with-text__wrapper flex dir-col align-center justify-center row-gap-40">
        {% render 'snippet-headings' section_headings: section_headings %}
        {% if section_media.size > 0 %}
            <div class="b-custom-media-with-text__media flex dir-col align-center row-gap-10">
                {% for media in section_media %}
                    {% assign section_image = media.settings.section_image %}
                    {% assign section_video = media.settings.section_video %}
                    {% assign section_external_video = media.settings.section_external_video %}
                      {% if section_image %}
                          {{ section_image | image_url: width: 500 | image_tag: class: 'b-custom-media-with-text__image image',  loading: 'lazy'}}
                      {% endif %}
                      {% if section_video %}
                          {{ section_video | video_tag: autoplay: true, loop: true, muted: true, controls: true,  loading: 'lazy', class: 'b-custom-media-with-text__video' }}
                      {% endif %}
                    {% if section_external_video contains 'youtube.com' %}
                    {% assign video_id = section_external_video | split: 'watch?v=' | last %}
                    {% assign youtube_embed_url = 'https://www.youtube.com/embed/' | append: video_id %}
                      <iframe
                        width="100%"
                        height="100%"
                        class="b-custom-media-with-text__video"
                        src="{{ youtube_embed_url }}"
                        frameborder="0"
                        allowfullscreen
                      ></iframe>
                    {% elsif section_external_video contains 'vimeo.com' %}
                      {% assign video_id = section_external_video | split: '/' | last %}
                      {% assign vimeo_embed_url = 'https://player.vimeo.com/video/' | append: video_id %}
                        <iframe
                          src="{{ vimeo_embed_url }}"
                          width="100%"
                          height="100%"
                          class="b-custom-media-with-text__video"
                          frameborder="0"
                          allow="autoplay; fullscreen; picture-in-picture"
                          allowfullscreen
                        ></iframe>
                  {% endif %}
                {% endfor %}
            </div>
        {% endif %}
        </div>
    </div>
</section>

{% schema %}
{
    "name": "Custom Media With Text",
    "settings": [],
    "blocks": [
      {
        "type": "text",
        "name": "Text",
        "settings": [
          {
            "type": "select",
            "id": "custom_heading",
            "label": "Choose Heading",
            "options": [
              {
                "value": "h1",
                "label": "H1"
              },
              {
                "value": "h2",
                "label": "H2"
              },
              {
                "value": "h3",
                "label": "H3"
              },
              {
                "value": "h4",
                "label": "H4"
              },
              {
                "value": "h5",
                "label": "H5"
              },
              {
                "value": "h6",
                "label": "H6"
              }
            ],
            "default": "h2"
          },
          {
            "type": "richtext",
            "id": "heading_text",
            "label": "Heading Text"
          },
          {
            "type": "color",
            "id": "heading_color",
            "label": "Heading Color",
            "default": "#000000"
          },
          {
            "type": "font_picker",
            "id": "heading_font",
            "label": "Heading Font",
            "default": "helvetica_n4"
          }
        ]
      },
      {
        "type": "media",
        "name": "Media",
        "settings": [
          {
            "type": "image_picker",
            "id": "section_image",
            "label": "Upload Image"
          },
          {
            "type": "video",
            "id": "section_video",
            "label": "Upload Shopify Video"
          },
          {
            "type": "video_url",
            "id": "section_external_video",
            "label": "Upload Youtube or Vimeo Video",
            "accept": [
              "youtube",
              "vimeo"
            ]
          }
        ]
      }
    ],
    "presets": [
        {
            "name": "Custom Media With Text"
        }
    ]
  }
{% endschema %}